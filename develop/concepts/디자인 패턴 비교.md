---
created: 2026-02-05
updated: 2026-02-05
tags: [concept, oop, design, backend]
status: done
---

# 디자인 패턴 비교

> Provider, Strategy, Factory 패턴의 역할과 적용 위치를 비교하여 실무에서 올바르게 선택할 수 있도록 정리합니다.

---

## 1. 패턴 요약

| 패턴 | 목적 | 위치 | 싱글톤 | 대표 예시 |
|------|------|------|--------|----------|
| **Provider** | 외부 리소스/API 추상화 | infrastructure/ | ✅ Yes | LLM API, Storage, 외부 SDK |
| **Strategy** | 비즈니스 알고리즘 교체 | domain/ | ❌ No | 선정 로직, 정렬, 필터링 |
| **Factory** | 객체 생성 로직 캡슐화 | core/dependencies.py | 함수로 구현 | Provider 선택, Strategy 선택 |

---

## 2. Provider Pattern

### 2.1 정의

외부 리소스나 API와의 연동을 추상화하는 패턴입니다. 인프라 계층에 위치하며, 외부 의존성을 캡슐화하여 비즈니스 로직이 특정 구현에 종속되지 않도록 합니다.

### 2.2 특징

- **위치:** `infrastructure/` 레이어
- **싱글톤:** ✅ 리소스 재사용을 위해 싱글톤으로 관리
- **책임:** 외부 시스템과의 통신 세부사항 캡슐화

### 2.3 구현 예시

```python
# infrastructure/ai/batch/base_batch_provider.py
from abc import ABC, abstractmethod

class BaseBatchProvider(ABC):
    @abstractmethod
    async def submit_batch(self, request):
        """배치 작업 제출"""
        pass

    @abstractmethod
    async def get_batch_status(self, batch_name):
        """배치 상태 조회"""
        pass
```

```python
# infrastructure/ai/batch/gemini_batch_provider.py
class GeminiBatchProvider(BaseBatchProvider):
    def __init__(self):
        self.client = GeminiClient()

    async def submit_batch(self, request):
        return await self.client.create_batch(request)

    async def get_batch_status(self, batch_name):
        return await self.client.get_status(batch_name)
```

```python
# 싱글톤 DI
from functools import lru_cache

@lru_cache
def get_gemini_batch_provider() -> GeminiBatchProvider:
    return GeminiBatchProvider()
```

### 2.4 언제 사용하는가

- 외부 API 호출 (LLM, 결제, 알림 등)
- 스토리지 접근 (S3, GCS, 로컬 파일시스템)
- 외부 SDK 래핑
- 인프라 리소스 관리

---

## 3. Strategy Pattern

### 3.1 정의

동일한 문제를 해결하는 여러 알고리즘을 정의하고, 런타임에 교체할 수 있도록 하는 패턴입니다. 비즈니스 로직 내에서 알고리즘의 변형이 필요할 때 사용합니다.

### 3.2 특징

- **위치:** `domain/` 레이어
- **싱글톤:** ❌ 상태가 없고 가벼우므로 매번 생성
- **책임:** 비즈니스 알고리즘 구현

### 3.3 구현 예시

```python
# domain/batch/strategies/base_selection_strategy.py
from abc import ABC, abstractmethod

class BaseSelectionStrategy(ABC):
    @abstractmethod
    async def select_items(
        self,
        subject_id: str,
        count: int
    ) -> list[BatchItem]:
        """항목 선정 알고리즘"""
        pass
```

```python
# domain/batch/strategies/english_selection_strategy.py
class EnglishSelectionStrategy(BaseSelectionStrategy):
    def __init__(self, keyword_repo, question_type_repo):
        self.keyword_repo = keyword_repo
        self.question_type_repo = question_type_repo

    async def select_items(self, subject_id: str, count: int):
        keywords = await self.keyword_repo.get_by_subject(subject_id)
        types = await self.question_type_repo.get_all()
        # 영어 과목 특화 선정 로직
        return self._apply_english_rules(keywords, types, count)
```

```python
# domain/batch/strategies/korean_selection_strategy.py
class KoreanSelectionStrategy(BaseSelectionStrategy):
    def __init__(self, passage_repo, question_type_repo):
        self.passage_repo = passage_repo
        self.question_type_repo = question_type_repo

    async def select_items(self, subject_id: str, count: int):
        passages = await self.passage_repo.get_by_subject(subject_id)
        types = await self.question_type_repo.get_all()
        # 국어 과목 특화 선정 로직
        return self._apply_korean_rules(passages, types, count)
```

```python
# 매번 생성하는 DI
def get_english_selection_strategy(session: AsyncSession):
    return EnglishSelectionStrategy(
        keyword_repo=KeywordRepository(session),
        question_type_repo=QuestionTypeRepository(session),
    )
```

### 3.4 언제 사용하는가

- 알고리즘이 여러 변형을 가질 때
- 조건에 따라 다른 비즈니스 로직을 적용할 때
- if-else 분기가 복잡해질 때 대체

---

## 4. Factory Pattern

### 4.1 정의

객체 생성 로직을 별도로 캡슐화하는 패턴입니다. 클라이언트 코드가 구체적인 클래스를 알 필요 없이 적절한 객체를 얻을 수 있게 합니다.

### 4.2 특징

- **위치:** `core/dependencies.py` 또는 해당 레이어
- **구현:** Python에서는 함수로 간단하게 구현
- **책임:** 조건에 따른 올바른 객체 선택 및 생성

### 4.3 구현 예시

```python
# core/dependencies.py
from enum import Enum

class LLMProvider(Enum):
    GEMINI = "gemini"
    OPENAI = "openai"
    CLAUDE = "claude"

class SubjectArea(Enum):
    ENGLISH = "english"
    KOREAN = "korean"
    MATH = "math"


def get_batch_provider(provider: LLMProvider) -> BaseBatchProvider:
    """Provider Factory - 싱글톤 인스턴스 반환"""
    match provider:
        case LLMProvider.GEMINI:
            return get_gemini_batch_provider()
        case LLMProvider.OPENAI:
            return get_openai_batch_provider()
        case LLMProvider.CLAUDE:
            return get_claude_batch_provider()
        case _:
            raise ValueError(f"Unknown provider: {provider}")


def get_selection_strategy(
    subject_area: SubjectArea,
    session: AsyncSession
) -> BaseSelectionStrategy:
    """Strategy Factory - 매번 새 인스턴스 생성"""
    match subject_area:
        case SubjectArea.ENGLISH:
            return get_english_selection_strategy(session)
        case SubjectArea.KOREAN:
            return get_korean_selection_strategy(session)
        case SubjectArea.MATH:
            return get_math_selection_strategy(session)
        case _:
            raise ValueError(f"Unknown subject: {subject_area}")
```

### 4.4 언제 사용하는가

- 생성할 객체 타입이 런타임에 결정될 때
- 객체 생성 로직이 복잡하거나 조건부일 때
- DI 컨테이너 역할이 필요할 때

---

## 5. 패턴 간 관계

```
┌─────────────────────────────────────────────────────────────┐
│                        Client Code                          │
│                    (API Router, Service)                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Factory (dependencies.py)                │
│  ┌─────────────────────┐    ┌─────────────────────────┐    │
│  │ get_batch_provider()│    │ get_selection_strategy()│    │
│  └─────────────────────┘    └─────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
           │                              │
           ▼                              ▼
┌─────────────────────┐      ┌─────────────────────────────┐
│    Provider Layer   │      │       Strategy Layer        │
│  (infrastructure/)  │      │         (domain/)           │
│                     │      │                             │
│  BaseBatchProvider  │      │  BaseSelectionStrategy      │
│    ├─ Gemini        │      │    ├─ English               │
│    ├─ OpenAI        │      │    ├─ Korean                │
│    └─ Claude        │      │    └─ Math                  │
│                     │      │                             │
│  [싱글톤 - 재사용]   │      │  [인스턴스 - 매번 생성]      │
└─────────────────────┘      └─────────────────────────────┘
           │                              │
           ▼                              ▼
    외부 API 호출                    비즈니스 로직 실행
```

---

## 6. 프로젝트 구조 예시

```
app/
├── infrastructure/
│   └── ai/batch/
│       ├── base_batch_provider.py      ← Provider 추상
│       ├── gemini_batch_provider.py    ← Provider 구현 (싱글톤)
│       ├── openai_batch_provider.py
│       └── claude_batch_provider.py
│
├── domain/batch/
│   ├── batch_service.py                ← Service (Strategy 주입받음)
│   └── strategies/
│       ├── base_selection_strategy.py  ← Strategy 추상
│       ├── english_selection_strategy.py
│       ├── korean_selection_strategy.py
│       └── math_selection_strategy.py
│
└── core/
    └── dependencies.py
        ├── get_batch_provider()         ← Provider Factory
        └── get_selection_strategy()     ← Strategy Factory
```

---

## 7. 선택 가이드

| 상황 | 사용할 패턴 |
|------|------------|
| 외부 API를 여러 개 지원해야 함 | Provider |
| 비즈니스 로직에 여러 알고리즘 변형이 있음 | Strategy |
| 조건에 따라 다른 객체를 생성해야 함 | Factory |
| 리소스를 재사용해야 함 (연결 풀 등) | Provider + 싱글톤 |
| 요청마다 다른 설정이 필요함 | Strategy + 매번 생성 |

---

## 관련 문서

- [[SOLID]] - 객체지향 설계 5원칙
- [[일반화와 추상화]] - 추상화의 기본 개념

---

## 참고 자료

- [Design Patterns: Elements of Reusable Object-Oriented Software](https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612) - GoF
- [Refactoring Guru - Strategy Pattern](https://refactoring.guru/design-patterns/strategy)
- [Refactoring Guru - Factory Method](https://refactoring.guru/design-patterns/factory-method)
